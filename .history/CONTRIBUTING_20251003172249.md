# Contributing Guide

This project uses a two-layer local guardrail setup:

- Python (repo root): pre-commit with Ruff (format+lint), Bandit (SAST), and detect-secrets
- Next.js dashboard (workspace-*/): Husky + lint-staged with Prettier, ESLint, and TypeScript type-checks

## Prerequisites

- Git installed and the repository initialized (required for hooks to attach)
- Python 3.13 available as `python`
- Node.js LTS (>=18)

## Python (repo root)

1. Install developer tools:

```bash
python -m pip install -U pre-commit ruff bandit detect-secrets pip-audit
```

2. Install the pre-commit hooks:

```bash
pre-commit install
```

3. (Optional) Regenerate a secrets baseline:

```bash
# Only if you prefer baseline scanning. The default config scans staged files directly.
detect-secrets scan --all-files > .secrets.baseline
```

4. Run checks on all files (local only):

```bash
pre-commit run --all-files
```

## Next.js dashboard (workspace-*/)

1. From the dashboard directory, install dev dependencies:

```bash
npm install -D husky lint-staged prettier
```

2. Initialize Husky (requires Git):

```bash
npm run prepare
```

3. The pre-commit hook runs:

- `npm run type-check` (TypeScript)
- `npx lint-staged` (Prettier + ESLint for staged files)

## Bypass and troubleshooting

- To bypass hooks: `git commit --no-verify`
- If hooks do not run, ensure you are inside a Git repository and Husky/pre-commit are installed.
- Windows users: run commands from an elevated terminal if PATH warnings appear.

## CI

CI workflows enforce linting, tests, and security scans. See `.github/workflows/quality-assurance.yml` once created.


## Security Scanning (PR & Weekly)

- Automated security scans run on every PR to `main` and weekly (Sunday 03:00 UTC)
- Tools: Semgrep, Bandit, ESLint (security), Gitleaks; optional weekly CodeQL
- Alerts appear in the GitHub Security tab; PRs receive a summary comment

### Requirements for PRs
- Fix Critical/High findings or provide a justified suppression before merging
- Do not commit secrets; rotate and remove immediately if detected

### Common Fixes
- Python: avoid `shell=True` and string-concatenated commands; use list argv and `check=True`
- SQL: prefer ORM/parameterized queries over raw string-formatted SQL
- JS/TS: avoid `dangerouslySetInnerHTML`; sanitize HTML
- Network: validate outbound URLs (allowlist host/scheme) to minimize SSRF

See docs/SECURITY_AUDIT.md for local run instructions and suppression guidance.
